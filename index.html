<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Vantix CRM</title>
        <link rel="stylesheet" href="styles.css" />
    </head>
    <body>
        <!-- Development Environment Banner (hidden by default, shown via JavaScript) -->
        <div id="dev-environment-banner" style="display: none; background: #dc3545; color: white; text-align: center; padding: 8px; font-weight: bold; position: fixed; top: 0; left: 0; right: 0; z-index: 10000; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            üöß DEV ENVIRONMENT üöß
        </div>
        
        <div class="container">
            <header>
                <div class="header-content">
                    <div class="left-header">
                        <h1>Vantix CRM</h1>
                        <nav>
                            <button id="dashboard-btn" class="nav-btn active">
                                Dashboard
                            </button>
                            <button id="add-customer-btn" class="nav-btn">
                                Add Customer
                            </button>
                            <button id="import-btn" class="nav-btn">
                                Import CSV
                            </button>
                        </nav>
                    </div>
                    <div class="user-menu">
                        <div class="user-dropdown">
                            <button class="user-avatar" id="user-avatar">
                                <span id="user-name">Loading...</span>
                                <svg class="dropdown-icon" width="12" height="12" viewBox="0 0 12 12" fill="none">
                                    <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <div class="dropdown-menu" id="dropdown-menu">
                                <a href="#" id="my-profile" class="dropdown-item" onclick="app.showUserProfile()">Account Settings</a>
                                <a href="/users.html" id="manage-users" class="dropdown-item" style="display: none;">Manage Users</a>
                                <div class="dropdown-divider"></div>
                                <a href="#" id="logout-btn" class="dropdown-item">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <main>
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view active">
                    <div class="dashboard-header">
                        <h2>Customers</h2>
                        <div class="loading" id="dashboard-loading" style="display: none;">
                            Loading customers...
                        </div>
                        <div class="error-message" id="dashboard-error" style="display: none"></div>
                    </div>

                    <!-- Filters Section -->
                    <div class="filters-section">
                        <div class="filter-controls">
                            <div class="filter-group">
                                <label>Status:</label>
                                <select id="status-filter">
                                    <option value="">All Statuses</option>
                                    <option value="Lead">Lead</option>
                                    <option value="Quoted">Quoted</option>
                                    <option value="Signed">Signed</option>
                                    <option value="Onboarding">Onboarding</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Affiliate:</label>
                                <select id="affiliate-filter">
                                    <option value="">All Affiliates</option>
                                    <option value="VOXO">VOXO</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Search:</label>
                                <input type="text" id="search-filter" placeholder="Company name or contact...">
                            </div>
                        </div>
                    </div>

                    <!-- Customers Table -->
                    <div class="table-container">
                        <table class="customers-table" id="customers-table">
                            <thead>
                                <tr>
                                    <th data-sort="company_name">Company Name <span class="sort-indicator"></span></th>
                                    <th data-sort="status">Status <span class="sort-indicator"></span></th>
                                    <th data-sort="affiliate_partner">Affiliate <span class="sort-indicator"></span></th>
                                    <th data-sort="primary_contact">Contact <span class="sort-indicator"></span></th>
                                    <th>Phone</th>
                                    <th data-sort="next_step">Next Step <span class="sort-indicator"></span></th>
                                    <th>Files</th>
                                    <th>Last Note</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="customers-table-body">
                                <!-- Table rows will be populated here -->
                            </tbody>
                        </table>
                        
                        <div class="empty-state" id="empty-state" style="display: none">
                            <p>No customers found. <a href="#" id="add-first-customer">Add your first customer</a></p>
                        </div>
                    </div>

                    <!-- Next Actions Section -->
                    <div class="next-actions-section">
                        <h3>Next Actions</h3>
                        <div class="table-container">
                            <table class="next-actions-table" id="next-actions-table">
                                <thead>
                                    <tr>
                                        <th>Company Name</th>
                                        <th>Next Step</th>
                                        <th>Due Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="next-actions-table-body">
                                    <!-- Next actions will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Customer Detail View -->
                <div id="customer-detail-view" class="view">
                    <div id="customer-detail-content">
                        <!-- Customer detail content will be populated here -->
                    </div>
                </div>

                <!-- Add/Edit Customer View -->
                <div id="customer-form-view" class="view">
                    <div class="form-header">
                        <h2 id="form-title">Add Customer</h2>
                        <button id="back-btn" class="btn btn-secondary">
                            ‚Üê Back to Dashboard
                        </button>
                    </div>

                    <!-- Auto-Fill Section -->
                    <div class="auto-fill-section" id="auto-fill-section">
                        <div class="form-section">
                            <h3>Quick Fill from Text</h3>
                            <div class="form-group">
                                <label for="paste-note-email"
                                    >Paste Note or Email</label
                                >
                                <textarea
                                    id="paste-note-email"
                                    placeholder="Paste an email, note, or any text containing customer information here..."
                                    rows="6"
                                ></textarea>
                            </div>
                            <div class="auto-fill-actions">
                                <button
                                    type="button"
                                    id="auto-fill-btn"
                                    class="btn btn-primary"
                                    disabled
                                >
                                    Auto-Fill Form
                                </button>
                                <button
                                    type="button"
                                    id="clear-paste-btn"
                                    class="btn btn-secondary"
                                >
                                    Clear
                                </button>
                            </div>
                        </div>
                    </div>

                    <form id="customer-form">
                        <div class="form-section">
                            <h3>Basic Information</h3>
                            <div class="form-group">
                                <label for="company-name">Company Name *</label>
                                <input
                                    type="text"
                                    id="company-name"
                                    name="companyName"
                                    required
                                />
                            </div>

                            <div class="form-group">
                                <label for="affiliate-partner">Affiliate Partner</label>
                                <select id="affiliate-partner" name="affiliatePartner">
                                    <option value="">Select Affiliate Partner</option>
                                    <option value="VOXO">VOXO</option>
                                    <option value="Network Tigers">Network Tigers</option>
                                    <option value="Rhino Networks">Rhino Networks</option>
                                    <option value="Direct">Direct</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="next-step">Next Step</label>
                                <select id="next-step" name="nextStep">
                                    <option value="">Select Next Step</option>
                                    <option value="Follow with VOXO AE">Follow with VOXO AE</option>
                                    <option value="Schedule Install">Schedule Install</option>
                                    <option value="Perform Install">Perform Install</option>
                                    <option value="Order Hardware and License">Order Hardware and License</option>
                                    <option value="Send Quote">Send Quote</option>
                                    <option value="Follow Up Call">Follow Up Call</option>
                                    <option value="Send Agreement">Send Agreement</option>
                                    <option value="Training Scheduled">Training Scheduled</option>
                                    <option value="Go Live">Go Live</option>
                                    <option value="No Action Needed">No Action Needed</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="status">Status</label>
                                <select id="status" name="status">
                                    <option value="Lead">Lead</option>
                                    <option value="Quoted">Quoted</option>
                                    <option value="Signed">Signed</option>
                                    <option value="Onboarding">Onboarding</option>
                                    <option value="Active">Active</option>
                                    <option value="Inactive">Inactive</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Physical Address</h3>
                            <div class="form-group">
                                <label for="phys_street1"
                                    >Street Address 1</label
                                >
                                <input type="text" id="phys_street1" name="phys_street1" />
                            </div>
                            <div class="form-group">
                                <label for="phys_street2"
                                    >Street Address 2</label
                                >
                                <input type="text" id="phys_street2" name="phys_street2" />
                            </div>
                            <div class="form-group">
                                <label for="phys_city">City</label>
                                <input type="text" id="phys_city" name="phys_city" />
                            </div>
                            <div class="form-group">
                                <label for="phys_state">State</label>
                                <select id="phys_state" name="phys_state">
                                    <option value="">Select a state</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <!-- Add remaining states as needed -->
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="phys_zip">Zip Code</label>
                                <input type="text" id="phys_zip" name="phys_zip" />
                            </div>

                            <div class="form-group checkbox-group">
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        id="sameAsPhysical"
                                    />
                                    <span class="checkmark"></span>
                                    Billing address is the same as physical
                                    address
                                </label>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Billing Address</h3>
                            <div class="form-group">
                                <label for="bill_street1"
                                    >Street Address 1</label
                                >
                                <input type="text" id="bill_street1" name="bill_street1" />
                            </div>
                            <div class="form-group">
                                <label for="bill_street2"
                                    >Street Address 2</label
                                >
                                <input type="text" id="bill_street2" name="bill_street2" />
                            </div>
                            <div class="form-group">
                                <label for="bill_city">City</label>
                                <input type="text" id="bill_city" name="bill_city" />
                            </div>
                            <div class="form-group">
                                <label for="bill_state">State</label>
                                <select id="bill_state" name="bill_state">
                                    <option value="">Select a state</option>
                                    <option value="AL">Alabama</option>
                                    <option value="AK">Alaska</option>
                                    <option value="AZ">Arizona</option>
                                    <option value="AR">Arkansas</option>
                                    <option value="CA">California</option>
                                    <!-- Add remaining states as needed -->
                                    <option value="WY">Wyoming</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="bill_zip">Zip Code</label>
                                <input type="text" id="bill_zip" name="bill_zip" />
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Primary Contact</h3>
                            <div class="contact-fields">
                                <div class="form-group">
                                    <label for="primary-name">Name</label>
                                    <input
                                        type="text"
                                        id="primary-name"
                                        name="primaryContact.name"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="primary-email">Email</label>
                                    <input
                                        type="email"
                                        id="primary-email"
                                        name="primaryContact.email"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="primary-phone">Phone</label>
                                    <input
                                        type="tel"
                                        id="primary-phone"
                                        name="primaryContact.phone"
                                    />
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Authorized Signer</h3>
                            <div class="form-group checkbox-group">
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        id="signer-same-as-primary"
                                    />
                                    <span class="checkmark"></span>
                                    Authorized Signer is the same as Primary
                                    Contact
                                </label>
                            </div>
                            <div class="contact-fields">
                                <div class="form-group">
                                    <label for="signer-name">Name</label>
                                    <input
                                        type="text"
                                        id="signer-name"
                                        name="authorizedSigner.name"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="signer-email">Email</label>
                                    <input
                                        type="email"
                                        id="signer-email"
                                        name="authorizedSigner.email"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="signer-phone">Phone</label>
                                    <input
                                        type="tel"
                                        id="signer-phone"
                                        name="authorizedSigner.phone"
                                    />
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Billing Contact</h3>
                            <div class="form-group checkbox-group">
                                <label class="checkbox-label">
                                    <input
                                        type="checkbox"
                                        id="billing-same-as-primary"
                                    />
                                    <span class="checkmark"></span>
                                    Billing Contact is the same as Primary
                                    Contact
                                </label>
                            </div>
                            <div class="contact-fields">
                                <div class="form-group">
                                    <label for="billing-name">Name</label>
                                    <input
                                        type="text"
                                        id="billing-name"
                                        name="billingContact.name"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="billing-email">Email</label>
                                    <input
                                        type="email"
                                        id="billing-email"
                                        name="billingContact.email"
                                    />
                                </div>
                                <div class="form-group">
                                    <label for="billing-phone">Phone</label>
                                    <input
                                        type="tel"
                                        id="billing-phone"
                                        name="billingContact.phone"
                                    />
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>AI-Powered Text Parser</h3>
                            
                            <!-- Test Mode Toggle - Hidden in Production -->
                            <div class="form-group" id="test-mode-section" style="display: none;">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="test-mode-toggle">
                                    Test Mode (preview only - won't save to database)
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label for="paste-note-email">
                                    Paste Email or Text to Auto-Fill Form
                                </label>
                                <textarea
                                    id="paste-note-email"
                                    rows="5"
                                    placeholder="Paste emails, notes, or any text containing customer information. AI will automatically extract and populate the form fields."
                                ></textarea>
                            </div>
                            <div class="form-group">
                                <button
                                    type="button"
                                    id="auto-fill-btn"
                                    class="btn btn-secondary"
                                    disabled
                                >
                                    Auto-Fill Form
                                </button>
                                <button
                                    type="button"
                                    id="clear-paste-btn"
                                    class="btn btn-secondary"
                                >
                                    Clear
                                </button>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Additional Information</h3>
                            <div class="form-group">
                                <label for="paste-text"
                                    >Notes</label
                                >
                                <textarea
                                    id="paste-text"
                                    name="pasteText"
                                    rows="3"
                                    placeholder="Additional notes or information"
                                ></textarea>
                            </div>
                        </div>

                        <div
                            class="duplicate-warning"
                            id="duplicate-warning"
                            style="display: none"
                        >
                            <p>‚ö†Ô∏è <span id="duplicate-message"></span></p>
                        </div>

                        <div class="form-actions">
                            <button
                                type="submit"
                                class="btn btn-primary"
                                id="save-btn"
                            >
                                Save Customer
                            </button>
                            <button
                                type="button"
                                class="btn btn-secondary"
                                id="cancel-btn"
                            >
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- User Profile Modal -->
                <div id="user-profile-modal" class="modal" style="display: none;">
                    <div class="modal-content large-modal">
                        <div class="modal-header">
                            <h3>Account Settings</h3>
                            <button class="modal-close" onclick="app.closeUserProfile()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="profile-sections">
                                <!-- Profile Information -->
                                <div class="profile-section">
                                    <h4>Profile Information</h4>
                                    <div class="form-group">
                                        <label for="profile-name">Name</label>
                                        <input type="text" id="profile-name" name="name" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-email">Email</label>
                                        <input type="email" id="profile-email" name="email" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="profile-role">Role</label>
                                        <input type="text" id="profile-role" name="role" readonly>
                                    </div>
                                </div>

                                <!-- Two-Factor Authentication -->
                                <div class="profile-section">
                                    <h4>Two-Factor Authentication</h4>
                                    <div class="security-status">
                                        <div class="status-display">
                                            <span class="security-label">Status:</span>
                                            <span class="status-indicator" id="profile-2fa-status">
                                                <span class="status-text">Disabled</span>
                                            </span>
                                        </div>
                                        <div class="security-actions">
                                            <button class="btn btn-primary" id="enable-profile-2fa-btn" style="display: none;" onclick="app.enable2FA()">Enable 2FA</button>
                                            <button class="btn btn-danger" id="disable-profile-2fa-btn" style="display: none;" onclick="app.disable2FA()">Disable 2FA</button>
                                        </div>
                                    </div>
                                    <div class="security-description">
                                        <p>Two-factor authentication adds an extra layer of security to your account by requiring a verification code from your authenticator app in addition to your password.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2FA Setup Modal -->
                <div id="setup-2fa-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Enable Two-Factor Authentication</h3>
                            <button class="modal-close" onclick="app.close2FASetup()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div id="password-verification-section">
                                <p>Please enter your current password to continue:</p>
                                <div class="form-group">
                                    <label for="verify-password">Current Password</label>
                                    <input type="password" id="verify-password" required>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-primary" onclick="app.verifyPasswordFor2FA()">Continue</button>
                                    <button class="btn btn-secondary" onclick="app.close2FASetup()">Cancel</button>
                                </div>
                            </div>

                            <div id="qr-setup-section" style="display: none;">
                                <div class="setup-steps">
                                    <div class="step">
                                        <h5>Step 1: Install an Authenticator App</h5>
                                        <p>Download Google Authenticator, Authy, or Microsoft Authenticator on your mobile device.</p>
                                    </div>
                                    
                                    <div class="step">
                                        <h5>Step 2: Scan QR Code</h5>
                                        <div class="qr-code-container">
                                            <img id="profile-qr-code" src="" alt="QR Code">
                                        </div>
                                        <p><strong>Can't scan the code?</strong> Enter this key manually:</p>
                                        <div class="manual-entry" id="profile-manual-key"></div>
                                    </div>

                                    <div class="step">
                                        <h5>Step 3: Enter Verification Code</h5>
                                        <p>Enter the 6-digit code from your authenticator app:</p>
                                        <div class="form-group">
                                            <input type="text" id="profile-verify-token" class="two-factor-input" 
                                                   placeholder="000000" maxlength="6" pattern="[0-9]{6}" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button class="btn btn-primary" onclick="app.complete2FASetup()">Enable 2FA</button>
                                    <button class="btn btn-secondary" onclick="app.close2FASetup()">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2FA Disable Confirmation Modal -->
                <div id="disable-2fa-modal" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Disable Two-Factor Authentication</h3>
                            <button class="modal-close" onclick="app.closeDisable2FA()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="warning-message">
                                <p><strong>Warning:</strong> Disabling two-factor authentication will make your account less secure.</p>
                            </div>
                            <p>Enter the 6-digit code from your authenticator app to confirm:</p>
                            <div class="form-group">
                                <input type="text" id="disable-verify-token" class="two-factor-input" 
                                       placeholder="000000" maxlength="6" pattern="[0-9]{6}" required>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-danger" onclick="app.confirmDisable2FA()">Disable 2FA</button>
                                <button class="btn btn-secondary" onclick="app.closeDisable2FA()">Cancel</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Detail View -->
                <div id="customer-detail-view" class="view">
                    <div class="detail-header">
                        <h2 id="detail-company-name"></h2>
                        <div class="detail-actions">
                            <button
                                id="edit-customer-btn"
                                class="btn btn-primary"
                            >
                                Edit
                            </button>
                            <button
                                id="delete-customer-btn"
                                class="btn btn-danger"
                            >
                                Delete
                            </button>
                            <button
                                id="back-to-dashboard-btn"
                                class="btn btn-secondary"
                            >
                                ‚Üê Back
                            </button>
                        </div>
                    </div>

                    <div class="customer-details" id="customer-details">
                        <!-- Customer details will be populated here -->
                    </div>

                    <div class="notes-section">
                        <h3>Notes</h3>
                        <form id="note-form">
                            <div class="form-group">
                                <textarea
                                    id="new-note"
                                    placeholder="Add a note..."
                                    rows="3"
                                ></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                Add Note
                            </button>
                        </form>

                        <div class="notes-list" id="notes-list">
                            <!-- Notes will be populated here -->
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <script src="script.js"></script>
    </body>
</html>
